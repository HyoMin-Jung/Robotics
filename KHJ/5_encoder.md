# 5. 엔코더 모터 (Encoder Motor)

## 5.1. 엔코더 모터의 정의

엔코더 모터는 모터의 회전 속도, 방향 및 위치를 정밀하게 감지하고 제어하기 위해 엔코더가 통합된 형태의 모터입니다. 일반 모터는 단순히 전압이나 전류 인가를 통해 구동되지만, 엔코더 모터는 엔코더를 통해 얻은 회전 정보를 제어 시스템에 피드백하여 보다 정확하고 안정적인 모션 제어가 가능하게 합니다. 주로 로봇 공학, 자동화 시스템, 정밀 기기 등에서 위치 및 속도 제어가 중요한 애플리케이션에 사용됩니다.

## 5.2. 엔코더 부의 역할, 구성 방식 및 작동 원리

### 5.2.1. 역할

엔코더는 모터의 회전과 관련된 기계적인 움직임(각도, 회전 수)을 전기적인 신호(주로 펄스 형태)로 변환하는 센서 역할을 합니다. 이 신호를 통해 모터의 현재 상태(위치, 속도, 가속도)를 파악할 수 있으며, 이를 기반으로 제어 시스템은 모터를 원하는 대로 정밀하게 구동하기 위한 제어 명령을 생성합니다. 즉, 엔코더는 폐루프(Closed-loop) 제어 시스템에서 필수적인 피드백 요소입니다.

### 5.2.2. 구성 방식

엔코더는 작동 원리에 따라 다양한 방식으로 구성될 수 있습니다. 대표적인 방식은 다음과 같습니다.

* **광학식 엔코더 (Optical Encoder):** 가장 흔하게 사용되는 방식으로, 빛을 방출하는 발광부와 빛을 감지하는 수광부, 그리고 정밀하게 패턴이 새겨진 디스크(회전형) 또는 스케일(직선형)로 구성됩니다. 디스크/스케일의 패턴을 빛이 통과하거나 반사될 때 발생하는 빛의 변화를 수광부에서 감지하여 전기 신호로 변환합니다. 정밀도가 높다는 장점이 있습니다.
* **자기식 엔코더 (Magnetic Encoder):** 자석과 자기 센서(예: 홀 효과 센서)를 이용하는 방식입니다. 회전축에 부착된 자석의 자기장 변화를 자기 센서가 감지하여 신호로 변환합니다. 먼지, 습기 등에 강하여 열악한 환경에서도 비교적 안정적으로 작동하는 장점이 있습니다.
* **기계식 엔코더 (Mechanical Encoder):** 접점의 물리적인 접촉을 이용하여 신호를 생성하는 방식입니다. 구조가 간단하고 저렴하지만, 마모로 인해 수명이 짧고 노이즈에 취약하다는 단점이 있습니다. 주로 저가형 장비나 간단한 입력 장치에 사용됩니다.

또한, 엔코더는 출력 신호의 형태에 따라 크게 두 가지로 나뉩니다.

* **증분형 엔코더 (Incremental Encoder):** 모터의 상대적인 위치 변화를 펄스 형태로 출력합니다. 전원이 켜진 이후의 이동량만 측정할 수 있으며, 정확한 절대 위치를 알기 위해서는 기준점(Index 펄스 또는 초기화 과정)이 필요합니다. A, B 두 개의 채널에서 위상 차이가 $90^\circ$인 펄스 신호를 출력하여 회전 방향을 판별할 수 있게 합니다. 경우에 따라 한 바퀴 회전 시마다 기준점을 나타내는 Z 채널(Index) 펄스를 추가로 제공하기도 합니다.
* **절대형 엔코더 (Absolute Encoder):** 모터의 회전 위치를 고유한 디지털 코드 값으로 출력합니다. 전원이 꺼졌다 켜져도 현재의 정확한 절대 위치를 알 수 있다는 장점이 있습니다. 여러 개의 트랙에 다양한 패턴이 새겨진 디스크를 사용하며, 각 위치마다 고유한 코드(이진 코드, 그레이 코드 등)가 생성됩니다.

### 5.2.3. 작동 원리

증분형 광학식 엔코더를 예로 들면, 모터 샤프트에 부착된 디스크에는 일정한 간격으로 슬릿(Slit) 또는 패턴이 새겨져 있습니다. 발광부에서 나온 빛이 이 디스크를 통과하거나 반사될 때, 슬릿/패턴의 유무에 따라 빛이 차단되거나 통과하게 됩니다. 수광부는 이 빛의 변화를 감지하여 구형파 형태의 전기 펄스 신호로 변환합니다.

두 개의 수광부를 $90^\circ$의 위상 차이가 나도록 배치하면, A 채널과 B 채널에서 $90^\circ$ 위상 차이가 나는 펄스 신호가 출력됩니다. 모터가 정방향으로 회전할 때는 A 채널 펄스가 B 채널 펄스보다 앞서고, 역방향으로 회전할 때는 B 채널 펄스가 A 채널 펄스보다 앞서게 됩니다. 제어기는 이 두 신호의 위상 관계를 분석하여 회전 방향을 판단하고, 발생한 펄스의 개수를 카운트하여 회전량을 계산합니다. Z 채널 펄스는 원점 복귀 등의 목적으로 사용될 수 있습니다.

절대형 엔코더는 여러 개의 트랙에 각도에 따라 고유한 이진 코드 패턴이 새겨져 있으며, 여러 개의 수광부가 각 트랙의 패턴을 동시에 읽어 현재 각도에 해당하는 디지털 코드 값을 출력하는 방식입니다.

## 5.3. 펄스와 해상도의 개념 및 관계

* **펄스 (Pulse):** 엔코더가 회전 또는 이동함에 따라 발생하는 전기적인 신호의 최소 단위입니다. 증분형 엔코더의 경우, 디스크의 하나의 슬릿 또는 패턴을 통과할 때마다 하나의 펄스가 발생한다고 생각할 수 있습니다 (체배 방식에 따라 다를 수 있음).
* **해상도 (Resolution):** 엔코더가 측정할 수 있는 가장 작은 각도 또는 이동 단위를 나타냅니다. 일반적으로 로터리 엔코더의 해상도는 모터 샤프트가 1회전할 때 발생하는 펄스의 총 개수로 표현되며, 단위는 **PPR (Pulses Per Revolution)** 또는 **CPR (Counts Per Revolution)**을 사용합니다. CPR은 A, B 두 채널 신호의 상승 에지와 하강 에지를 모두 사용하여 펄스 수를 4배로 계산하는 4체배 방식을 기준으로 하기도 합니다. 예를 들어, 1000 PPR 엔코더는 샤프트가 한 바퀴 돌 때 1000개의 펄스를 발생시킵니다.

**관계:** 엔코더의 해상도가 높을수록 1회전당 더 많은 펄스를 발생시키므로, 모터의 회전 각도 변화를 더 미세하게 감지할 수 있습니다. 이는 곧 위치 및 속도 제어의 정밀도가 높아짐을 의미합니다. 해상도가 $N$ PPR인 엔코더를 사용한다면, 1펄스당 회전 각도는 $360^\circ / N$이 됩니다. 4체배 방식을 사용한다면 1카운트당 회전 각도는 $360^\circ / (N \times 4)$가 됩니다.

## 5.4. 엔코더 데이터를 활용해 속도 및 거리를 계산하는 방법

엔코더에서 출력되는 펄스 데이터를 이용하여 모터의 속도와 이동 거리를 계산할 수 있습니다.

### 5.4.1. 속도 계산

속도는 단위 시간당 회전량 또는 이동량으로 계산할 수 있습니다. 증분형 엔코더의 펄스 수를 이용하여 속도를 계산하는 방법은 크게 M 방식과 T 방식이 있습니다.

* **M 방식 (Frequency Measurement Method):** 일정한 시간 간격($\Delta t$) 동안 발생한 펄스의 개수($\Delta P$)를 측정하여 속도를 계산합니다. 이 방식은 고속 회전 시에 유리합니다.

    회전 속도 (RPM)는 다음과 같이 계산할 수 있습니다.
    $$ \text{RPM} = \frac{\Delta P}{\text{PPR} \times \text{체배 수}} \times \frac{60}{\Delta t} $$
    여기서 $\Delta t$의 단위는 초(s)입니다.

    예를 들어, 1000 PPR 엔코더를 4체배 방식으로 사용하고, 0.1초 동안 500개의 펄스가 감지되었다면 RPM은 다음과 같습니다.
    $$ \text{RPM} = \frac{500}{1000 \times 4} \times \frac{60}{0.1} = \frac{500}{4000} \times 600 = 0.125 \times 600 = 75 \text{ RPM} $$

    마이크로컨트롤러 등에서 일정 주기 타이머 인터럽트를 활용하여 $\Delta t$ 동안의 펄스 수를 카운트하는 방식으로 구현할 수 있습니다.

* **T 방식 (Period Measurement Method):** 연속하는 두 펄스 사이의 시간 간격($\Delta T$)을 측정하여 속도를 계산합니다. 이 방식은 저속 회전 시에 유리합니다.

    회전 속도 (RPM)는 다음과 같이 계산할 수 있습니다.
    $$ \text{RPM} = \frac{1}{\Delta T \times \text{PPR} \times \text{체배 수}} \times 60 $$
    여기서 $\Delta T$의 단위는 초(s)이며, 한 펄스당 걸린 시간입니다.

    예를 들어, 1000 PPR 엔코더를 4체배 방식으로 사용하고, 한 펄스를 감지하는 데 0.001초가 걸렸다면 RPM은 다음과 같습니다.
    $$ \text{RPM} = \frac{1}{0.001 \times 1000 \times 4} \times 60 = \frac{1}{4} \times 60 = 0.25 \times 60 = 15 \text{ RPM} $$

    마이크로컨트롤러 등에서 외부 인터럽트와 타이머/카운터를 활용하여 펄스 간의 시간 간격을 측정하는 방식으로 구현할 수 있습니다.

실제 구현에서는 M 방식과 T 방식을 혼합하여 사용하는 M/T 방식을 통해 넓은 속도 범위에서 정확한 측정을 수행하기도 합니다.

### 5.4.2. 거리 계산

로터리 엔코더의 펄스 수를 이용하여 직선 이동 거리를 계산하려면, 모터 샤프트에 연결된 바퀴의 둘레를 알아야 합니다.

이동 거리 ($D$)는 다음과 같이 계산할 수 있습니다.
$$ D = \text{펄스 총 개수} \times \text{펄스당 이동 거리} $$

여기서 '펄스당 이동 거리'는 바퀴의 둘레를 1회전당 펄스 수(PPR x 체배 수)로 나눈 값입니다. 바퀴의 반지름을 $r$이라고 하면 둘레는 $2\pi r$입니다.

따라서 이동 거리는 다음과 같습니다.
$$ D = \text{펄스 총 개수} \times \frac{2 \pi r}{\text{PPR} \times \text{체배 수}} $$

예를 들어, 반지름이 5cm인 바퀴가 달린 로봇에 1000 PPR 엔코더를 4체배 방식으로 사용하여 총 10000개의 펄스를 감지했다면, 이동 거리는 다음과 같습니다.
$$ D = 10000 \times \frac{2 \pi \times 5 \text{ cm}}{1000 \times 4} = 10000 \times \frac{10 \pi \text{ cm}}{4000} = 10000 \times \frac{\pi}{400} \text{ cm} \approx 10000 \times 0.00785 \text{ cm} = 78.5 \text{ cm} $$

## 5.5. 엔코더 데이터와 실제 주행 결과와의 차이가 발생하는 이유 및 보정 방법

엔코더 데이터는 모터 샤프트의 회전량을 기준으로 계산되므로, 실제 로봇이나 시스템의 주행 결과와 차이가 발생할 수 있습니다. 이러한 차이의 원인은 다양하며, 주요 원인과 보정 방법은 다음과 같습니다.

### 5.5.1. 차이 발생 이유

* **기계적인 오차:**
    * **바퀴 미끄러짐 (Wheel Slip):** 특히 가속 또는 감속 시, 또는 노면 상태가 좋지 않을 때 바퀴가 지면에서 미끄러지면서 엔코더가 감지한 회전량과 실제 이동 거리 사이에 차이가 발생합니다.
    * **바퀴 직경 오차:** 바퀴의 실제 직경이 설계 값과 미세하게 다르거나, 마모 등으로 인해 변할 수 있습니다. 이는 거리 계산에 오차를 유발합니다.
    * **기구 백래시 (Backlash):** 기어 등의 기계적인 연결 부위에서 발생하는 유격으로 인해 모터 샤프트의 회전이 실제 구동부의 움직임으로 정확하게 전달되지 않을 수 있습니다.
    * **정렬 불량:** 여러 개의 바퀴가 있는 경우, 각 바퀴의 정렬 상태가 틀어지면 직진 주행 시에도 엔코더 데이터와 실제 이동 경로에 차이가 발생합니다.
* **엔코더 자체의 오차:**
    * **주기적 오차 (SDE - Sub-Divisional Error):** 엔코더 신호 처리 과정에서 발생하는 비선형적인 오차입니다. 특히 아날로그 신호를 디지털로 변환할 때 발생할 수 있습니다.
    * **노이즈 (Noise):** 외부 전기적 간섭이나 신호선의 문제로 인해 펄스 신호에 오류가 발생할 수 있습니다.
    * **해상도의 한계:** 엔코더의 해상도보다 작은 움직임은 감지할 수 없으므로 미세한 위치 오차가 누적될 수 있습니다.
* **제어 시스템의 샘플링 속도:** 엔코더 펄스 데이터를 읽어오는 샘플링 속도가 충분히 빠르지 않으면 빠른 움직임에서 펄스를 놓치거나 정확한 타이밍을 파악하기 어려울 수 있습니다.

### 5.5.2. 보정 방법

* **캘리브레이션 (Calibration):**
    * **거리 캘리브레이션:** 알려진 거리를 실제 주행해보고, 이때 엔코더에서 감지된 총 펄스 수를 측정합니다. 이를 통해 실제 '펄스당 이동 거리' 값을 계산하여 거리 계산 공식에 적용합니다. 예를 들어, 1미터를 주행했을 때 엔코더 펄스가 2000개 감지되었다면, 1펄스당 이동 거리는 $1 \text{ m} / 2000 = 0.0005 \text{ m/pulse}$가 됩니다.
    * **바퀴 직경 측정 및 보정:** 바퀴의 실제 직경을 정밀하게 측정하여 계산에 사용합니다.
* **센서 융합 (Sensor Fusion):** 엔코더 데이터 외에 다른 센서 정보(예: IMU - 관성 측정 장치, 카메라, 라이다)를 함께 사용하여 위치 및 속도 정보를 보정합니다. 예를 들어, IMU의 가속도 및 각속도 데이터를 이용하여 짧은 시간 동안의 이동량을 추정하고 엔코더 데이터와 결합하여 오차를 줄일 수 있습니다.
* **제어 알고리즘 개선:** 슬립을 줄이기 위한 제어 알고리즘(예: 트랙션 제어)을 적용하거나, 모델 예측 제어 등을 사용하여 시스템의 동적 특성을 고려한 정밀 제어를 수행합니다.
* **고해상도 엔코더 사용:** 가능한 높은 해상도의 엔코더를 사용하여 측정 정밀도를 높입니다.
* **신호 처리 개선:** 엔코더 신호에 대한 필터링 등을 통해 노이즈의 영향을 줄입니다.
* **주기적 오차 보상:** 일부 고정밀 시스템에서는 엔코더의 주기적 오차 패턴을 미리 파악하여 룩업 테이블(Lookup Table) 형태로 저장해두고, 측정된 엔코더 값에 해당하는 오차를 보상하는 방식을 사용하기도 합니다.